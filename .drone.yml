pipeline:
  build:
    image: plugins/docker
    repo: mtimoustafa/minecraft-box
    username:
      from_secret: docker_username
    password:
      from_secret: docker_password
    tags:
      - ${DRONE_COMMIT_BRANCH}
    when:
      event: push

  deploy:
    image: amazon/aws-cli
    environment:
      AWS_ACCESS_KEY_ID:
        from_secret: aws_access_key_id
      AWS_SECRET_ACCESS_KEY:
        from_secret: aws_secret_access_key
    commands:
      - ecs update-service --cluster minecraft-box-cluster --service minecraft-box-service --force-new-deployment
    when:
      branch: master
      event: push

